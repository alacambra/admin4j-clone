<?xml version="1.0"?>
<!--
  Copyright 2002-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">
<document>
	<header>
		<title>Memory Issue Management</title>
		<notice>Copyright © 2010, by The Admin4J Project, all rights reserved.</notice>
	</header>
	<body>
	
		<section>
							<title>Detecting memory issues at runtime</title>
							
							<p>The Admin4J memory issue monitor will notify administators of memory issues.
								A 'memory issue' is an observation that memory usage in the JVM is larger than 
								a given threshold.  </p>
								
							<p>Memory issues lead to OutOfMemory errors and spuratic application outages for users.</p>
		
							<p>The memory issue monitor operates on a work/sleep cycle.  The length of the 'sleep' cycle
							  and the memory usage threshold.</p>
		</section>
							  
		<section>
				<title>Installing Memory Usage Monitoring</title>
				
				<note>If you followed the installation procedure detailed in the <a href="getting-started.html">Getting Started</a>
						section, there is no need to install the memory monitor separately.  Only follow this procedure if you're
						not using the Admin4J Home Page Servlet.</note>

				<p>Add the following servlet to your applications web.xml:</p>
				<source><![CDATA[
<servlet>
<servlet-name>Memory Monitor Startup Servlet </servlet-name>
<servlet-class>net.admin4j.ui.servlets.MemoryMonitorStartupServlet</servlet-class>
<load-on-startup>1</load-on-startup>
</servlet>
				]]></source>

				<p>Note that there is no servlet mapping as there is nothing to display.  The monitor is started
					 with the initialization of the startup servlet.</p>

				<p>The following configuration parameters are supported for the thread contention monitor.  You specify
					 these parameters as init parametes on the startup servlet:</p>
					 <table>
						<tr>
							<th>Parameter</th>
							<th>Required</th>
							<th>Default</th>
							<th>Description</th>
					 </tr>
					 <tr>
							<td>sleep.interval.millis</td>
							<td>N</td>
							<td>Default 30000 (30 sec)</td>
							<td>Amount of time in millis monitor will sleep between checks.</td>					 
					 </tr>
					 <tr>
							<td>memory.threshold.pct</td>
							<td>N</td>
							<td>90</td>
							<td>The percentage of memory that must be allocated before low memory warnings are issued.</td>					 
					 </tr>
					 <tr>
							<td>memory.nbr.low.watermark.intervals</td>
							<td>N</td>
							<td></td>
							<td>48</td>
							<td>Number of low watermark observations reported with a low memory notice.</td>
					 </tr>
					 <tr>
							<td>memory.low.watermark.monitor.interval.millis</td>
							<td>N</td>
							<td></td>
							<td>1800000</td>
							<td>Number of Millis between low watermark observations.</td>
					 </tr>
					 <tr>
							<td>nbr.intervals.between.warnings</td>
							<td>N</td>
							<td>30</td>
							<td>Number of intervals low memory must be experienced before repeat warnings are issued.</td>					 
					 </tr>
					 <tr>
							<td>notifier</td>
							<td>Y</td>
							<td>Defaults to default.notifier.class value in the Admin4J configuration.</td>
							<td>Handles admin notification.  See documentation for the Notifier you're using
									for any additional configuration requirements. See Admin4J Notifiers section
									for more detail.</td>					 
					 </tr>
					</table>

</section>

<section>
				<title>Monitoring memory usage in containers servicing multiple applications.</title>

				<p>You only need one memory usage monitor per JVM.  If the container you which to monitor services
					 multiple applications, it's on necessary to install the memory monitor startup servlet in one of 
					 those applications.</p>

</section>
					
		
	
	</body>
	<footer>
		<legal>Copyright © 2010, by The Admin4J Project, all rights reserved.</legal>
	</footer>
</document>
